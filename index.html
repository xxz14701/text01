<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="01.png">
    <title>ä¸€å€‹å­—ä¸€ç¨®é¡è‰²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¼‰å…¥è‡ªè¨‚å­—å‹ */
        @font-face {
            font-family: 'GenSenRounded';
            src: url('GenSenRounded2TW-H.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
            background-color: #f2d5f1;
        }

        /* æ»‘æ¡¿å„ªåŒ– */
        input[type="range"] {
            height: 30px;
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #f63b99;
            cursor: pointer;
            margin-top: -10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #f2d5f1;
            border-radius: 4px;
        }

        /* é¡è‰²é¸æ“‡å™¨ */
        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 50px;
            height: 50px;
            cursor: pointer;
            padding: 0;
            background: none;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: 3px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        .color-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 50px;
        }
        .color-char-label {
            font-size: 1.2rem;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* é è¦½å€èƒŒæ™¯ */
        .preview-bg {
            background-image: 
                linear-gradient(45deg, #e5e7eb 25%, transparent 25%), 
                linear-gradient(-45deg, #e5e7eb 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #e5e7eb 75%), 
                linear-gradient(-45deg, transparent 75%, #e5e7eb 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: white;
        }

        #text-preview {
            display: inline-block;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1;
            font-family: 'GenSenRounded', "Microsoft JhengHei", sans-serif;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- æ¨™é¡Œå€ -->
    <header class="bg-pink-600 text-white p-6 text-center shadow-lg">
        <h1 class="text-3xl md:text-4xl font-bold tracking-wide">â¤ï¸ä¸€å€‹å­—ä¸€ç¨®é¡è‰²â¤ï¸</h1>
        <p class="text-lg mt-2 opacity-90">è®“æ¯å€‹æ–‡å­—éƒ½æ“æœ‰è‡ªå·±çš„è‰²å½©!</p>
    </header>

    <div class="container mx-auto p-4 max-w-6xl">
        
        <div class="flex flex-col lg:flex-row gap-8">
            
            <!-- å·¦å´:è¨­å®šå€ -->
            <div class="w-full lg:w-1/2 space-y-6">
                
                <!-- æ­¥é©Ÿ 1: è¼¸å…¥æ–‡å­— -->
                <div class="bg-white p-6 rounded-2xl shadow-md border-2 border-orange-100">
                    <h2 class="text-xl font-bold mb-4 text-orange-700 border-b pb-2 flex items-center">
                        <span class="text-2xl mr-2">1ï¸âƒ£</span> è¼¸å…¥æ–‡å­—
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-lg font-medium mb-2">è«‹è¼¸å…¥æ–‡å­—:</label>
                            <textarea id="text-input" rows="3" class="w-full p-4 text-xl border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring-2 focus:ring-orange-200 outline-none transition" placeholder="ä¾‹å¦‚:å¹³å®‰å–œæ¨‚">å¹³å®‰å–œæ¨‚</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-lg font-medium mb-2">æ›´æ›å­—å‹ (é¸å¡«):</label>
                            <label class="flex flex-col items-center justify-center w-full h-16 border-2 border-dashed border-gray-400 rounded-xl cursor-pointer hover:bg-gray-50 hover:border-orange-400 transition bg-gray-50">
                                <span class="text-gray-600 font-medium">ğŸ“‚ é»æ­¤é¸æ“‡é›»è…¦è£¡çš„å­—å‹æª”æ¡ˆ</span>
                                <input type="file" id="font-upload" accept=".ttf,.otf" class="hidden">
                            </label>
                            <p id="fontNameDisplay" class="text-sm text-green-600 mt-1 hidden">âœ… å·²è¼‰å…¥å­—å‹</p>
                            <p class="text-gray-600 text-sm mt-1">ğŸ’¡ é è¨­ä½¿ç”¨ã€Œæºæ³‰åœ“é«”ã€å­—å‹</p>
                        </div>
                    </div>
                </div>

                <!-- æ­¥é©Ÿ 2: è¨­å®šé¡è‰² -->
                <div class="bg-white p-6 rounded-2xl shadow-md border-2 border-blue-100">
                    <h2 class="text-xl font-bold mb-4 text-blue-700 border-b pb-2 flex items-center">
                        <span class="text-2xl mr-2">2ï¸âƒ£</span> é»æ“Šåœ“åœˆæ”¹é¡è‰²
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-xl border border-blue-200 min-h-[100px]">
                            <div id="color-pickers-container" class="flex flex-wrap justify-start gap-3">
                                <!-- é€™è£¡æœƒè‡ªå‹•ç”¢ç”Ÿé¡è‰²é¸æ“‡å™¨ -->
                            </div>
                        </div>
                        <p class="text-gray-600 text-sm">ğŸ’¡ å°æç¤º:ä¸Šæ–¹çš„åœ“åœˆå°æ‡‰æ‚¨è¼¸å…¥çš„æ¯ä¸€å€‹å­—ã€‚</p>
                    </div>
                </div>

                <!-- æ­¥é©Ÿ 3: èª¿æ•´æ¨£å¼ -->
                <div class="bg-white p-6 rounded-2xl shadow-md border-2 border-purple-100">
                    <h2 class="text-xl font-bold mb-4 text-purple-700 border-b pb-2 flex items-center">
                        <span class="text-2xl mr-2">3ï¸âƒ£</span> èª¿æ•´å¤§å°èˆ‡æ¨£å¼
                    </h2>
                    
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-lg font-medium mb-2">æ–‡å­—å¤§å° (å¤§/å°): <span id="val-font-size" class="text-orange-600 font-bold">80</span></label>
                                <input type="range" id="font-size" min="20" max="200" value="80">
                            </div>
                            <div>
                                <label class="block text-lg font-medium mb-2">æ–‡å­—é–“è· (å¯¬/çª„): <span id="val-letter-spacing" class="text-orange-600 font-bold">2</span></label>
                                <input type="range" id="letter-spacing" min="0" max="50" value="2">
                            </div>
                            <div>
                                <label class="block text-lg font-medium mb-2">è¡Œçš„é«˜åº¦ (é«˜/ä½): <span id="val-line-height" class="text-orange-600 font-bold">1.2</span></label>
                                <input type="range" id="line-height" min="0.8" max="3" step="0.1" value="1.2">
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-xl space-y-4">
                            <div>
                                <label class="block text-lg font-medium mb-2">æ–‡å­—å¤–æ¡†ç²—ç´°: <span id="val-border-width" class="text-orange-600 font-bold">2</span></label>
                                <input type="range" id="border-width" min="0" max="20" value="2">
                            </div>
                            <div class="flex items-center gap-4">
                                <label class="text-lg font-medium">å¤–æ¡†é¡è‰²:</label>
                                <input type="color" id="border-color" value="#000000" class="h-12 w-20 rounded cursor-pointer border-2 border-gray-300">
                            </div>
                        </div>

                        <div class="flex items-center space-x-3 p-3 rounded-xl border border-gray-200">
                            <input type="checkbox" id="toggle-shadow" class="w-6 h-6 text-orange-600 rounded focus:ring-orange-500 border-gray-300 cursor-pointer">
                            <label for="toggle-shadow" class="text-lg font-bold cursor-pointer select-none">é–‹å•Ÿæ–‡å­—é™°å½± (ç«‹é«”æ„Ÿ)</label>
                        </div>
                    </div>
                </div>

            </div>

            <!-- å³å´:é è¦½èˆ‡ä¸‹è¼‰ -->
            <div class="w-full lg:w-1/2 lg:sticky lg:top-4 h-fit">
                <div class="bg-white p-6 rounded-2xl shadow-xl border-2 border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">
                        ğŸ‘€ æˆæœé è¦½
                    </h2>
                    
                    <div class="preview-bg rounded-xl overflow-hidden border-2 border-gray-300 mb-6 flex justify-center items-center p-8 min-h-[300px]">
                        <div id="text-preview"></div>
                    </div>

                    <div class="space-y-3">
                        <button onclick="downloadPNG()" class="w-full py-4 bg-green-600 hover:bg-green-700 text-white text-xl font-bold rounded-xl shadow-lg transform transition active:scale-95">
                            â¬‡ï¸ ä¸‹è¼‰åœ–ç‰‡ (èƒŒæ™¯é€æ˜)
                        </button>
                        <button onclick="downloadPNGWithBackground()" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold rounded-xl shadow-lg transform transition active:scale-95">
                            â¬‡ï¸ ä¸‹è¼‰åœ–ç‰‡ (ç™½è‰²èƒŒæ™¯)
                        </button>
                    </div>

                    <p class="text-center text-gray-500 mt-4 text-sm">
                        Billy ^.^ | Program improved by AI @2026
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('text-input');
        const fontUpload = document.getElementById('font-upload');
        const fontSize = document.getElementById('font-size');
        const letterSpacing = document.getElementById('letter-spacing');
        const lineHeight = document.getElementById('line-height');
        const borderWidth = document.getElementById('border-width');
        const borderColor = document.getElementById('border-color');
        const toggleShadow = document.getElementById('toggle-shadow');
        const textPreview = document.getElementById('text-preview');
        const colorPickersContainer = document.getElementById('color-pickers-container');
        
        const valFontSize = document.getElementById('val-font-size');
        const valLetterSpacing = document.getElementById('val-letter-spacing');
        const valLineHeight = document.getElementById('val-line-height');
        const valBorderWidth = document.getElementById('val-border-width');

        let colorPickers = [];

        // åˆå§‹åŒ–
        textInput.addEventListener('input', handleTextInput);
        fontUpload.addEventListener('change', updateFont);
        
        [fontSize, letterSpacing, lineHeight, borderWidth, borderColor, toggleShadow].forEach(el => {
            el.addEventListener('input', updateStyle);
        });

        window.onload = function() {
            handleTextInput();
        };

        function handleTextInput() {
            const text = textInput.value;
            const currentColors = [];
            
            const existingPickers = document.querySelectorAll('.color-picker');
            existingPickers.forEach(picker => currentColors.push(picker.value));

            colorPickersContainer.innerHTML = '';
            colorPickers = [];

            text.split('').forEach((char, index) => {
                if (char === '\n') return;

                const wrapper = document.createElement('div');
                wrapper.className = 'color-wrapper';

                const label = document.createElement('span');
                label.className = 'color-char-label';
                label.textContent = char;

                const colorPicker = document.createElement('input');
                colorPicker.type = 'color';
                colorPicker.className = 'color-picker';
                colorPicker.value = currentColors[index] || '#000000'; 
                
                colorPicker.addEventListener('input', updateStyle);

                wrapper.appendChild(label);
                wrapper.appendChild(colorPicker);
                colorPickersContainer.appendChild(wrapper);
                
                colorPickers.push(colorPicker);
            });

            updateStyle();
        }

        function updateStyle() {
            valFontSize.textContent = fontSize.value;
            valLetterSpacing.textContent = letterSpacing.value;
            valLineHeight.textContent = lineHeight.value;
            valBorderWidth.textContent = borderWidth.value;

            textPreview.style.fontSize = `${fontSize.value}px`;
            textPreview.style.letterSpacing = `${letterSpacing.value}px`;
            textPreview.style.lineHeight = lineHeight.value;
            textPreview.style.webkitTextStrokeWidth = `${borderWidth.value}px`;
            textPreview.style.webkitTextStrokeColor = borderColor.value;
            textPreview.style.textShadow = toggleShadow.checked ? '4px 4px 6px rgba(0,0,0,0.5)' : 'none';

            let pickerIndex = 0;
            const textHTML = textInput.value.split('').map((char) => {
                if (char === '\n') return '<br>';
                
                const color = colorPickers[pickerIndex] ? colorPickers[pickerIndex].value : '#000000';
                pickerIndex++;
                
                return `<span style="color: ${color};">${char}</span>`;
            }).join('');

            textPreview.innerHTML = textHTML;
        }

        function updateFont(event) {
            const file = event.target.files[0];
            if (!file) return;

            document.getElementById('fontNameDisplay').classList.remove('hidden');
            const reader = new FileReader();
            reader.onload = function(e) {
                const font = new FontFace('customFont', `url(${e.target.result})`);
                font.load().then(function(loadedFont) {
                    document.fonts.add(loadedFont);
                    textPreview.style.fontFamily = 'customFont';
                }).catch(err => {
                    alert('å­—å‹è¼‰å…¥å¤±æ•—,è«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚');
                });
            };
            reader.readAsDataURL(file);
        }

        // â”€â”€â”€ ç”¨ Canvas API ç›´æ¥ç•«å­—ï¼Œå®Œå…¨ä¸ä¾è³´ html2canvas â”€â”€â”€
        function renderToCanvas(bgColor) {
            const scale       = 2;
            const size        = parseInt(fontSize.value);
            const spacing     = parseInt(letterSpacing.value);
            const lh          = parseFloat(lineHeight.value);
            const stroke      = parseInt(borderWidth.value) || 0;
            const strokeCol   = borderColor.value;
            const shadow      = toggleShadow.checked;
            const fontFamily  = textPreview.style.fontFamily || "'GenSenRounded', 'Microsoft JhengHei', sans-serif";
            const fontStr     = `${size}px ${fontFamily}`;

            // æŠŠè¼¸å…¥æ–‡å­—æŒ‰è¡Œåˆ†å‰²
            const lines = textInput.value.split('\n');

            // â”€â”€ å…ˆç”¨ä¸€å€‹æš«æ™‚çš„ canvas ä¾†é‡æ¸¬ â”€â”€
            const measure = document.createElement('canvas');
            const mCtx    = measure.getContext('2d');
            mCtx.font     = fontStr;

            // é‡æ¯ä¸€è¡Œçš„å¯¬åº¦ï¼Œå–æœ€å¯¬è€…
            let maxW = 0;
            lines.forEach(line => {
                // æ¯å€‹å­—çš„å¯¬åº¦ + letter-spacingï¼ˆæœ€å¾Œä¸€å€‹å­—ä¸åŠ ï¼‰
                let lineW = 0;
                for (let i = 0; i < line.length; i++) {
                    lineW += mCtx.measureText(line[i]).width;
                    if (i < line.length - 1) lineW += spacing;
                }
                if (lineW > maxW) maxW = lineW;
            });

            const lineH   = size * lh;
            const totalH  = lineH * lines.length;

            // paddingï¼šstroke å…©é‚Šå„è†¨å¼µ, shadow æœ€å¤šè¶…å‡º offset+blur = 4+6=10
            const shadowPad = shadow ? 14 : 0;
            const pad       = stroke + shadowPad + 12;   // åŸºæœ¬ margin 12px

            // â”€â”€ å»ºæ­£å¼ canvas â”€â”€
            const canvas  = document.createElement('canvas');
            canvas.width  = (maxW  + pad * 2) * scale;
            canvas.height = (totalH + pad * 2) * scale;
            const ctx     = canvas.getContext('2d');
            ctx.scale(scale, scale);

            // ç•«èƒŒæ™¯
            if (bgColor) {
                ctx.fillStyle = bgColor;
                ctx.fillRect(0, 0, canvas.width / scale, canvas.height / scale);
            }

            // shadow è¨­å®š
            if (shadow) {
                ctx.shadowColor   = 'rgba(0,0,0,0.5)';
                ctx.shadowOffsetX = 4;
                ctx.shadowOffsetY = 4;
                ctx.shadowBlur    = 6;
            }

            ctx.font        = fontStr;
            ctx.textBaseline = 'middle';   // middle è®“ä¸Šä¸‹è‡ªå‹•å°é½Š

            // æ”¶é›†æ¯å€‹å­—çš„é¡è‰²ï¼ˆè·Ÿ colorPickers é †åºä¸€è‡´ï¼Œè·³é \nï¼‰
            const chars  = [];
            const colors = [];
            let pIdx = 0;
            textInput.value.split('').forEach(ch => {
                if (ch === '\n') { chars.push('\n'); colors.push(null); return; }
                chars.push(ch);
                colors.push(colorPickers[pIdx] ? colorPickers[pIdx].value : '#000000');
                pIdx++;
            });

            // â”€â”€ é€è¡Œé€å­—ç•« â”€â”€
            let charIdx = 0;
            lines.forEach((line, lineIdx) => {
                // é€™ä¸€è¡Œçš„æ–‡å­—ç¸½å¯¬ï¼ˆç”¨ä¾†å·¦å³å±…ä¸­ï¼‰
                let lineW = 0;
                for (let i = 0; i < line.length; i++) {
                    lineW += ctx.measureText(line[i]).width;
                    if (i < line.length - 1) lineW += spacing;
                }
                let x = pad + (maxW - lineW) / 2;   // å·¦å³å±…ä¸­
                const y = pad + lineH * lineIdx + lineH / 2;  // ä¸Šä¸‹å±…ä¸­æ–¼è©²è¡Œ

                for (let i = 0; i < line.length; i++) {
                    const ch    = line[i];
                    const color = colors[charIdx] || '#000000';
                    const charW = ctx.measureText(ch).width;

                    // å…ˆç•« strokeï¼ˆå¤–æ¡†ï¼‰
                    if (stroke > 0) {
                        ctx.strokeStyle  = strokeCol;
                        ctx.lineWidth    = stroke * 2;  // stroke å‘å…©é‚Šå„è†¨å¼µä¸€åŠ
                        ctx.lineJoin     = 'round';
                        ctx.strokeText(ch, x, y);
                    }

                    // ç•«æœ¬é«”
                    ctx.fillStyle = color;
                    ctx.fillText(ch, x, y);

                    x += charW + spacing;
                    charIdx++;
                }
                charIdx++; // è·³é \n
            });

            return canvas;
        }

        function downloadPNG() {
            const canvas = renderToCanvas(null);
            saveCanvasAsImage(canvas, 'text_trans.png');
        }

        function downloadPNGWithBackground() {
            const canvas = renderToCanvas('#ffffff');
            saveCanvasAsImage(canvas, 'text_white.png');
        }

        function saveCanvasAsImage(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>
</html>
