<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤šå½©æ–‡å­—ç”¢ç”Ÿå™¨ - é•·è¼©å‹å–„ç‰ˆ</title>
    <style>
        /* --- è¼‰å…¥è‡ªè¨‚å­—å‹ --- */
        @font-face {
            font-family: 'GenSenRounded';
            src: url('https://xxz14701.github.io/text01/GenSenRounded2TW-H.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --primary-color: #008080; /* ç©©é‡çš„è—ç¶ è‰²,è­·çœ¼ä¸”æ¸…æ™° */
            --primary-hover: #006666;
            --bg-color: #fcfcf5; /* æš–ç±³è‰²èƒŒæ™¯,å°æ¯”ä¸åˆºçœ¼ */
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-radius: 16px;
        }

        body { 
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            /* é˜²æ­¢æ‰‹æ©Ÿæ©«å‘æ»‘å‹• */
            overflow-x: hidden; 
        }

        h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        /* --- å®¹å™¨æ¨£å¼ --- */
        #container {
            background: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 800px; /* é›»è…¦ç‰ˆå¯¬åº¦åŠ å¯¬ */
            box-sizing: border-box;
        }

        /* --- åˆ†å€å¡ç‰‡ --- */
        .section-card {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #555;
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 24px;
            background-color: var(--primary-color);
            margin-right: 10px;
            border-radius: 4px;
        }

        /* --- è¡¨å–®æ§åˆ¶é … --- */
        .form-group {
            margin-bottom: 20px;
            width: 100%;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.1rem; /* æ¨™ç±¤å­—é«”åŠ å¤§ */
            color: #444;
        }

        textarea {
            width: 100%;
            box-sizing: border-box;
            resize: vertical;
            min-height: 100px;
            font-size: 1.2rem; /* è¼¸å…¥å­—é«”åŠ å¤§ */
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* --- æ»‘æ¡¿å„ªåŒ– (æ›´å®¹æ˜“æ‹‰å‹•) --- */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 25px; /* åŠ å¤§è§¸æ§å€ */
            background: transparent;
            margin: 10px 0;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 10px;
            background: #ddd;
            border-radius: 5px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 32px; /* æŒ‰éˆ•è®Šå¤§ */
            width: 32px;
            border-radius: 50%;
            background: var(--primary-color);
            margin-top: -11px; /* ç½®ä¸­ */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 2px solid #fff;
        }

        /* --- é¡è‰²é¸æ“‡å™¨ --- */
        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 50px;
            height: 50px;
            cursor: pointer;
            padding: 0;
            background: none;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: 3px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        #color-pickers-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start; /* é å·¦å°é½Š */
            gap: 10px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            min-height: 60px;
        }

        /* é¡è‰²é¸æ“‡å™¨ä¸‹æ–¹çš„æ–‡å­—æ¨™ç¤º */
        .color-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 50px;
        }
        .color-char-label {
            font-size: 1.2rem;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* --- é è¦½å€ --- */
        #preview-container {
            text-align: center;
            background-image: 
                linear-gradient(45deg, #eee 25%, transparent 25%), 
                linear-gradient(-45deg, #eee 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #eee 75%), 
                linear-gradient(-45deg, transparent 75%, #eee 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: white; /* æ£‹ç›¤æ ¼èƒŒæ™¯,æ–¹ä¾¿çœ‹é€æ˜å­— */
            padding: 20px;
            border-radius: 8px;
            border: 2px dashed #ccc;
            min-height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto; /* é¿å…æ–‡å­—è¶…å‡º */
        }

        #text-preview {
            display: inline-block;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1; /* é è¨­ */
            font-family: 'GenSenRounded', "Microsoft JhengHei", sans-serif;
        }

        /* --- æŒ‰éˆ•å€ --- */
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            min-width: 200px; /* é˜²æ­¢æŒ‰éˆ•åœ¨æ‰‹æ©Ÿä¸Šå¤ªå° */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .checkbox-container input {
            width: 24px;
            height: 24px;
            margin-right: 10px;
        }

        .footer-info {
            text-align: center;
            margin-top: 30px;
            color: #777;
            font-size: 0.9rem;
        }

        /* --- æ‰‹æ©Ÿç‰ˆé©é… --- */
        @media (max-width: 600px) {
            body { padding: 10px; }
            #container { padding: 15px; }
            h2 { font-size: 1.5rem; }
            .btn-group { flex-direction: column; }
            button { width: 100%; }
        }
    </style>
</head>
<body>

    <div id="container">
        <h2>ğŸ¨ å¤šå½©æ–‡å­—ç”¢ç”Ÿå™¨</h2>
        
        <!-- æ­¥é©Ÿ 1: è¼¸å…¥æ–‡å­— -->
        <div class="section-card">
            <div class="section-title">æ­¥é©Ÿ 1:è¼¸å…¥æ–‡å­—</div>
            <div class="form-group">
                <textarea id="text-input" placeholder="è«‹åœ¨é€™è£¡æ‰“å­—...">å¹³å®‰å–œæ¨‚</textarea>
            </div>
            
            <div class="form-group">
                <label for="font-upload">ğŸ“‚ æ›´æ›å­—å‹ (é¸å¡«,æ”¯æ´ .ttf æª”æ¡ˆ):</label>
                <input type="file" id="font-upload" accept=".ttf,.otf" style="font-size: 1rem; padding: 10px;">
            </div>
        </div>

        <!-- æ­¥é©Ÿ 2: è¨­å®šæ¯å€‹å­—çš„é¡è‰² -->
        <div class="section-card">
            <div class="section-title">æ­¥é©Ÿ 2:é»æ“Šåœ“åœˆæ›é¡è‰²</div>
            <div id="color-pickers-container">
                <!-- é€™è£¡æœƒè‡ªå‹•ç”¢ç”Ÿé¡è‰²é¸æ“‡å™¨ -->
            </div>
            <p style="color: #666; font-size: 1rem; margin-top: 10px;">ğŸ’¡ å°æç¤º:ä¸Šæ–¹çš„åœ“åœˆå°æ‡‰æ‚¨è¼¸å…¥çš„æ¯ä¸€å€‹å­—ã€‚</p>
        </div>

        <!-- æ­¥é©Ÿ 3: èª¿æ•´æ¨£å¼ -->
        <div class="section-card">
            <div class="section-title">æ­¥é©Ÿ 3:èª¿æ•´å¤§å°èˆ‡æ¨£å¼</div>
            
            <div class="form-group">
                <label for="font-size">æ–‡å­—å¤§å° (å¤§/å°): <span id="val-font-size">80</span></label>
                <input type="range" id="font-size" min="20" max="200" value="80">
            </div>

            <div class="form-group">
                <label for="letter-spacing">æ–‡å­—é–“è· (å¯¬/çª„): <span id="val-letter-spacing">2</span></label>
                <input type="range" id="letter-spacing" min="0" max="50" value="2">
            </div>

            <div class="form-group">
                <label for="line-height">è¡Œçš„é«˜åº¦ (é«˜/ä½): <span id="val-line-height">1.2</span></label>
                <input type="range" id="line-height" min="0.8" max="3" step="0.1" value="1.2">
            </div>
             
            <div class="form-group" style="background: #eef; padding: 15px; border-radius: 8px;">
                <label for="border-width">æ–‡å­—å¤–æ¡†ç²—ç´°:</label>
                <input type="range" id="border-width" min="0" max="20" value="2">
                
                <div style="display: flex; align-items: center; margin-top: 10px;">
                    <label for="border-color" style="margin:0 10px 0 0;">å¤–æ¡†é¡è‰²:</label>
                    <input type="color" id="border-color" value="#000000">
                </div>
            </div>

            <div class="form-group">
                <label class="checkbox-container">
                    <input type="checkbox" id="toggle-shadow"> 
                    é–‹å•Ÿæ–‡å­—é™°å½± (ç«‹é«”æ„Ÿ)
                </label>
            </div>
        </div>

        <!-- é è¦½å€ -->
        <div class="section-card" style="border-color: var(--primary-color);">
            <div class="section-title">âœ¨ æˆæœé è¦½</div>
            <div id="preview-container">
                <div id="text-preview"></div>
            </div>
        </div>

        <!-- ä¸‹è¼‰æŒ‰éˆ• -->
        <div class="btn-group">
            <button onclick="downloadPNG()">
                â¬‡ï¸ ä¸‹è¼‰åœ–ç‰‡<br><span style="font-size:0.8em">(èƒŒæ™¯é€æ˜)</span>
            </button>
            <button class="btn-secondary" onclick="downloadPNGWithBackground()">
                â¬‡ï¸ ä¸‹è¼‰åœ–ç‰‡<br><span style="font-size:0.8em">(ç™½è‰²èƒŒæ™¯)</span>
            </button>
        </div>

        <div class="footer-info">
            <p>Billy ^.^ | Program improved by Gemini @2026</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const textInput = document.getElementById('text-input');
        const fontUpload = document.getElementById('font-upload');
        const fontSize = document.getElementById('font-size');
        const letterSpacing = document.getElementById('letter-spacing');
        const lineHeight = document.getElementById('line-height');
        const borderWidth = document.getElementById('border-width');
        const borderColor = document.getElementById('border-color');
        const toggleShadow = document.getElementById('toggle-shadow');
        const textPreview = document.getElementById('text-preview');
        const colorPickersContainer = document.getElementById('color-pickers-container');
        
        // ç”¨ä¾†é¡¯ç¤ºæ•¸å€¼
        const valFontSize = document.getElementById('val-font-size');
        const valLetterSpacing = document.getElementById('val-letter-spacing');
        const valLineHeight = document.getElementById('val-line-height');

        let colorPickers = []; // å„²å­˜é¡è‰²é¸æ“‡å™¨çš„ DOM å…ƒç´ 

        // åˆå§‹åŒ–
        textInput.addEventListener('input', handleTextInput);
        fontUpload.addEventListener('change', updateFont);
        
        // ç¶å®šæ¨£å¼æ§åˆ¶é …
        [fontSize, letterSpacing, lineHeight, borderWidth, borderColor, toggleShadow].forEach(el => {
            el.addEventListener('input', updateStyle);
        });

        // é é¢è¼‰å…¥æ™‚å…ˆåŸ·è¡Œä¸€æ¬¡
        window.onload = function() {
            handleTextInput();
        };

        function handleTextInput() {
            const text = textInput.value;
            const currentColors = [];
            
            // 1. å…ˆæŠŠç›®å‰çš„é¡è‰²å­˜èµ·ä¾† (é¿å…æ‰“å­—æ™‚é¡è‰²é‡ç½®)
            const existingPickers = document.querySelectorAll('.color-picker');
            existingPickers.forEach(picker => currentColors.push(picker.value));

            // 2. æ¸…ç©ºå®¹å™¨
            colorPickersContainer.innerHTML = '';
            colorPickers = [];

            // 3. é‡æ–°ç”¢ç”Ÿé¡è‰²é¸æ“‡å™¨
            text.split('').forEach((char, index) => {
                // å¦‚æœæ˜¯æ›è¡Œç¬¦è™Ÿ,å°±ä¸ç”¢ç”Ÿé¡è‰²é¸æ“‡å™¨,ä½†è¦è™•ç†
                if (char === '\n') return;

                const wrapper = document.createElement('div');
                wrapper.className = 'color-wrapper';

                const label = document.createElement('span');
                label.className = 'color-char-label';
                label.textContent = char;

                const colorPicker = document.createElement('input');
                colorPicker.type = 'color';
                colorPicker.className = 'color-picker';
                // å˜—è©¦æ¢å¾©ä¹‹å‰çš„é¡è‰²,å¦‚æœæ²’æœ‰å‰‡é è¨­é»‘è‰²
                colorPicker.value = currentColors[index] || '#000000'; 
                
                colorPicker.addEventListener('input', updateStyle);

                wrapper.appendChild(label);
                wrapper.appendChild(colorPicker);
                colorPickersContainer.appendChild(wrapper);
                
                colorPickers.push(colorPicker);
            });

            updateStyle();
        }

        function updateStyle() {
            // æ›´æ–°æ•¸å€¼é¡¯ç¤º
            valFontSize.textContent = fontSize.value;
            valLetterSpacing.textContent = letterSpacing.value;
            valLineHeight.textContent = lineHeight.value;

            // æ›´æ–°é è¦½å€æ¨£å¼
            textPreview.style.fontSize = `${fontSize.value}px`;
            textPreview.style.letterSpacing = `${letterSpacing.value}px`;
            textPreview.style.lineHeight = lineHeight.value;
            
            // å¤–æ¡†è™•ç† (Webkit stroke)
            textPreview.style.webkitTextStrokeWidth = `${borderWidth.value}px`;
            textPreview.style.webkitTextStrokeColor = borderColor.value;
            
            // é™°å½±è™•ç†
            textPreview.style.textShadow = toggleShadow.checked ? '4px 4px 6px rgba(0,0,0,0.5)' : 'none';

            // é‡æ–°çµ„åˆæ–‡å­— HTML
            let pickerIndex = 0;
            const textHTML = textInput.value.split('').map((char) => {
                if (char === '\n') return '<br>';
                
                // å–å¾—å°æ‡‰çš„é¡è‰²
                const color = colorPickers[pickerIndex] ? colorPickers[pickerIndex].value : '#000000';
                pickerIndex++;
                
                return `<span style="color: ${color};">${char}</span>`;
            }).join('');

            textPreview.innerHTML = textHTML;
        }

        function updateFont(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const font = new FontFace('customFont', `url(${e.target.result})`);
                font.load().then(function(loadedFont) {
                    document.fonts.add(loadedFont);
                    textPreview.style.fontFamily = 'customFont';
                }).catch(err => {
                    alert('å­—å‹è¼‰å…¥å¤±æ•—,è«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚');
                });
            };
            reader.readAsDataURL(file);
        }

        function downloadPNG() {
            // æš«æ™‚éš±è—å¤–æ¡†èˆ‡èƒŒæ™¯,ç¢ºä¿ä¹¾æ·¨çš„æˆªåœ–
            html2canvas(textPreview, { 
                backgroundColor: null, 
                scale: 2,
                logging: false
            }).then(canvas => {
                saveCanvasAsImage(canvas, 'text_transparent.png');
            });
        }

        function downloadPNGWithBackground() {
            html2canvas(textPreview, { 
                backgroundColor: '#ffffff', 
                scale: 2,
                logging: false
            }).then(canvas => {
                saveCanvasAsImage(canvas, 'text_white.png');
            });
        }

        function saveCanvasAsImage(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>
</html>
